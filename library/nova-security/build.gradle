plugins {
    id 'java'
    id 'java-library'
}

java {
    sourceCompatibility = JavaVersion.VERSION_21
    targetCompatibility = JavaVersion.VERSION_21
}

bootJar {
    enabled = false
}

jar {
    enabled = true
}

dependencies {

    // --- [1. Core Framework] ---
    implementation project(':library:nova-core') // 내부 참조로 캡슐화
    implementation project(':library:nova-logging')
    api 'org.springframework.boot:spring-boot-starter-security'
    api 'org.springframework.cloud:spring-cloud-starter-openfeign' // 각 서비스에서 Feign을 사용 중일 때만 이 인터셉터가 활성화되도록 설계


    // 서블릿 API 및 Jackson 활용을 위해 최소한의 의존성 유지
    compileOnly 'org.springframework.boot:spring-boot-starter-web'
    implementation 'com.fasterxml.jackson.core:jackson-databind'  // Jackson 설정을 위한 기본 의존성 (Spring Boot 환경이라면 포함되어 있겠지만 명시적 선언)

    // --- [2. Security & Utilities] ---
    // HTML 이스케이프 및 텍스트 처리
    implementation('org.apache.commons:commons-text:1.11.0') {
        exclude group: 'org.apache.commons', module: 'commons-lang3'
    }
    // 2. 취약점 방어를 위한 버전 강제 고정 (전이 의존성 포함 제어)
    constraints {
        // 'implementation' 구성에 대해 제약을 겁니다.
        implementation('org.apache.commons:commons-lang3') {
            version {
                strictly '3.17.0' // 취약점이 해결된 버전으로 강제 고정
            }
            because 'GHSA-j288-q9x7-2f5v: 무한 재귀 호출을 통한 DoS 공격 방어'
        }
    }

    // HTML Sanitize (XSS 방지용)
    implementation 'org.jsoup:jsoup:1.18.1' // 2026년 기준 안정 버전

    // --- [3. Annotation Processors] ---
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'

    // --- [4. Test] ---
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testCompileOnly 'org.projectlombok:lombok'
    testAnnotationProcessor 'org.projectlombok:lombok'

}
